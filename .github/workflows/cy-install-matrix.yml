name: Cypress installer matrix (clean public)

on:
  push:
  pull_request:

# Use bash everywhere for consistent scripting (works on Windows/macOS/Linux)
defaults:
  run:
    shell: bash

jobs:
  cy-install:
    name: ${{ matrix.os }} â€¢ ${{ matrix.pm }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-24.04, macos-15, windows-2022]
        pm: [npm, pnpm, yarn]

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Keep each image's native Node; just ensure pnpm & yarn exist globally
      - name: Install pnpm & yarn globally
        run: |
          node -v
          npm -v
          npm i -g pnpm yarn
          pnpm -v
          yarn -v

      - name: Clean workspace
        run: |
          rm -rf node_modules package-lock.json pnpm-lock.yaml yarn.lock

      # FIRST: Install Cypress
      - name: Run cy:install via ${{ matrix.pm }}
        run: |
          if [[ "${{ matrix.pm }}" == "npm" ]]; then
            npm run cy:install
          elif [[ "${{ matrix.pm }}" == "pnpm" ]]; then
            pnpm run cy:install
          else
            yarn run cy:install
          fi

      # THEN: Validate the installation
      - name: Validate Cypress Installation
        run: |
          npx cypress verify

      - name: Show Cypress version
        run: |
          node -e "console.log('cypress version:', require('cypress/package.json').version)"
          npx cypress version
